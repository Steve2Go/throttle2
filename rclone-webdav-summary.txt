# Rclone WebDAV Integration Summary (Throttle2)

## Context
- Migrated from SSHFS/FUSE-based mounting to rclone-based mounting for SFTP servers.
- Implemented both FUSE (`rclone mount`) and WebDAV (`rclone serve webdav`) options.
- Goal: Allow Finder and macOS apps to access SFTP servers as network drives, with or without FUSE.

## Key Features Implemented
- **RcloneManager.swift**: Handles detection, download, config generation, mounting, and serving.
- **WebDAV Mounting**: `serveWebDAV(for:completion:)` starts a local WebDAV server for a given SFTP server.
- **Finder Integration**: User can mount the WebDAV URL in Finder via Connect to Server (Cmd+K).
- **No FUSE required for WebDAV**.

## Usage Example
```swift
RcloneManager.shared.serveWebDAV(for: server) { url in
    if let url = url {
        print("Mount this in Finder: \(url)")
        // Optionally, open Finder's Connect to Server dialog with this URL
    } else {
        print("Failed to start WebDAV server")
    }
}
```
- This will start rclone serving the SFTP remote as WebDAV on a unique local port.
- The user can then mount the URL (e.g., `http://127.0.0.1:8800/`) in Finder.

## Key rclone Config Settings
- Config sections are named after the SFTP host (e.g., `[srg.im]`).
- Key-based authentication omits the `pass` field.
- Key files are written to `~/Library/Application Support/Throttle2/bin/rclone-keys/`.

## Troubleshooting
- If mounting fails, run the rclone command manually with `-vv` for verbose output.
- Ensure the config section matches the remote name in the mount command.
- For FUSE-based mounts, ensure the mount directory exists before mounting.

## Next Steps
- To resume: Open this file, review the summary, and use the `serveWebDAV` method to test WebDAV mounting in Finder.
- If you want to automate opening Finder's Connect to Server dialog, ask for an AppleScript snippet.
- For stopping WebDAV servers, consider tracking the `Process` objects and terminating them as needed.

---
**This summary should get you back to testing and iterating on rclone WebDAV integration quickly!** 